<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

    <title>翻滚的蜗牛</title>
    <subtitle>Python,Linux,DevOps,Cloud</subtitle>
    <link href="http://blog.weittor.com/atom.xml" rel="self"/>
    <link href="http://blog.weittor.com"/>
    <updated>2015-03-19T13:14:42+08:00</updated>
    <id>http://blog.weittor.com</id>
    <author>
        <name>chris.hill</name>
    </author>
    
    <entry>
        <title>域名登记系统</title>
        <link href="http://blog.weittor.com/domain-managerment-used-django.html"/>
        <updated>2015-03-01T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/domain-managerment-used-django</id>
        <content type="html">&lt;hr&gt;

&lt;p&gt;使用django+bootstrap开发了一套用于域名登记和过期时间监控的应用。&lt;/p&gt;

&lt;h1&gt;组件&lt;/h1&gt;

&lt;p&gt;&lt;code&gt;Django1.4&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Bootstrap模板-ACE&lt;/code&gt;&lt;/p&gt;

&lt;h1&gt;功能&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;域名登记，申请登记&lt;/li&gt;
&lt;li&gt;域名过期时间监控，内置email提醒功能&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;截图如下&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/images/2015year/2015-3-1_domain01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2015year/2015-3-1_domain02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>Linux配置shadowsocks</title>
        <link href="http://blog.weittor.com/shadowsocks-install-in-linux-service.html"/>
        <updated>2014-07-21T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/shadowsocks-install-in-linux-service</id>
        <content type="html">&lt;hr&gt;

&lt;p&gt;shadowsocks是一个轻量级的sock5代理, 由python2.x写成.&lt;/p&gt;

&lt;p&gt;项目地址:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/clowwindy/shadowsocks&quot;&gt;https://github.com/clowwindy/shadowsocks&lt;/a&gt;&lt;/p&gt;

&lt;h1&gt;1.安装&lt;/h1&gt;

&lt;p&gt;Debian / Ubuntu&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;apt-get install python-pip python-m2crypto
pip install shadowsocks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CentOS&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;yum install m2crypto python-setuptools
easy_install pip
pip install shadowsocks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;2.配置&lt;/h1&gt;

&lt;p&gt;创建/etc/shadowsocks/config.json文件作为配置文件, 以下是一个样例:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;{
&amp;quot;server&amp;quot;:&amp;quot;remote-shadowsocks-server-ip-addr&amp;quot;,
&amp;quot;server_port&amp;quot;:8883,
&amp;quot;local_address&amp;quot;:&amp;quot;127.0.0.1&amp;quot;,
&amp;quot;local_port&amp;quot;:8883,
&amp;quot;password&amp;quot;:&amp;quot;whosyourdaddy&amp;quot;,
&amp;quot;timeout&amp;quot;:300,
&amp;quot;method&amp;quot;:&amp;quot;aes-256-cfb&amp;quot;,
&amp;quot;fast_open&amp;quot;:false,
&amp;quot;workers&amp;quot;:1
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;3.客户端&lt;/h1&gt;

&lt;p&gt;运行sslocal命令, 并指定配置文件即可&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sslocal -c /etc/shadowsocks.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;注意&lt;/em&gt;
如果无法在运行时加载config.json文件, 可尝试手动运行:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sslocal -s 服务器地址 -p 服务器端口 -l 本地端端口 -k 密码 -m 加密方法
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;4.服务端&lt;/h1&gt;

&lt;p&gt;&lt;em&gt;提示&lt;/em&gt;
普通用户无需配置服务端. 详细配置信息以及服务端的配置请移步:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.archlinux.org/index.php/Shadowsocks_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29&quot;&gt;Shadowsocks(简单中文) &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/clowwindy/shadowsocks&quot;&gt;Shadowsocks(官方Readme.md)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://zqhong.github.io/2014/10/08/how-to-setting-shadowsocks-client/&quot;&gt;http://zqhong.github.io/2014/10/08/how-to-setting-shadowsocks-client/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.v2ex.com/t/150064&quot;&gt;http://www.v2ex.com/t/150064&lt;/a&gt;&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>Linux系统内的Python软件包管理工具</title>
        <link href="http://blog.weittor.com/python-package-manager-list.html"/>
        <updated>2014-05-28T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/python-package-manager-list</id>
        <content type="html">&lt;hr&gt;

&lt;h1&gt;概括&lt;/h1&gt;

&lt;p&gt;常用的Python软件包管理工具包括：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Pip&lt;br&gt;
&lt;a href=&quot;https://pypi.python.org/pypi/pip&quot;&gt;https://pypi.python.org/pypi/pip&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;setuptools&lt;br&gt;
&lt;a href=&quot;https://pypi.python.org/pypi/setuptools&quot;&gt;https://pypi.python.org/pypi/setuptools&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;distribute&lt;br&gt;
&lt;a href=&quot;https://pypi.python.org/pypi/distribute&quot;&gt;https://pypi.python.org/pypi/distribute&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;Pip&lt;/h1&gt;

&lt;p&gt;官方简介&lt;br&gt;
&lt;code&gt;
A tool for installing and managing Python packages
&lt;/code&gt;&lt;/p&gt;

&lt;h2&gt;安装pip&lt;/h2&gt;

&lt;h3&gt;方法一&lt;/h3&gt;

&lt;p&gt;通过python脚本安装&lt;/p&gt;

&lt;p&gt;官方脚本地址&lt;br&gt;
&lt;a href=&quot;https://raw.github.com/pypa/pip/master/contrib/get-pip.py&quot;&gt;https://raw.github.com/pypa/pip/master/contrib/get-pip.py&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;通过管理员执行该脚本&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;python get-pip.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过该方法可以获得最新的pip版本。&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3&gt;方法二&lt;/h3&gt;

&lt;p&gt;通过系统管理工具安装。    &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;debian和ubuntu系统&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sudo apt-get install python-pip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;redhat和centos系统&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sudo yum install python-pip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;使用方法介绍&lt;/h2&gt;

&lt;p&gt;通过pip安装python软件包  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;pip install SomePackage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过pip卸载python软件包  &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;pip uninstall SomePackage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看过期的软件包&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;pip list --outdated
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;提示：若执行该命令出现&lt;code&gt;No command by the name pip list&lt;/code&gt;的报错
请用get-pip.py脚本安装最新版的pip&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;升级Python软件包&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;pip install --upgrade SomePackage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看哪些文件将要被安装&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;pip show --files SomePackage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;distribute&lt;/h1&gt;

&lt;p&gt;官方简介&lt;br&gt;
&lt;code&gt;Easily download, build, install, upgrade, and uninstall Python packages&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;该软件包基于setuptools进行了重构。
用法与setuptools类似。&lt;/p&gt;

&lt;h1&gt;setuptools&lt;/h1&gt;

&lt;p&gt;官方简介&lt;br&gt;
&lt;code&gt;Easily download, build, install, upgrade, and uninstall Python packages&lt;/code&gt;&lt;/p&gt;

&lt;h2&gt;安装方法&lt;/h2&gt;

&lt;h3&gt;方法一&lt;/h3&gt;

&lt;p&gt;通过官方提供的脚本安装。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;root用户安装&lt;br&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;wget https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py -O - &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; python
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;非root用户执行sudo安装&lt;br&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;wget https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py -O - &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; sudo python
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;方法二&lt;/h3&gt;

&lt;p&gt;通过系统管理工具安装。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;debian和ubuntu系统&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;sudo apt-get install python-setuptools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;redhat和centos系统&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;sudo yum install python-setuptools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;参考资料&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/12344290/pip-error-no-command-by-the-name-pip-uninstall&quot;&gt;http://stackoverflow.com/questions/12344290/pip-error-no-command-by-the-name-pip-uninstall&lt;/a&gt;&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>CentOS系统搭建gitolite服务</title>
        <link href="http://blog.weittor.com/set-up-gitolite.html"/>
        <updated>2014-05-24T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/set-up-gitolite</id>
        <content type="html">&lt;hr&gt;

&lt;p&gt;CentOS系统搭建gitolite服务&lt;/p&gt;

&lt;h1&gt;准备工作&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;客户端IP    192.168.20.26&lt;br&gt;
服务端IP    192.168.20.120&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1&gt;安装软件&lt;/h1&gt;

&lt;h2&gt;服务端执行&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;yum perl-Time-HiRes openssh-server perl 
yum -y install git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;客户端执行&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;yum -y install git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;添加用户&lt;/h1&gt;

&lt;h2&gt;服务端执行&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;groupadd git
useradd -g git -m  git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;设置密码 &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;passwd git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;!-- more --&gt;

&lt;h1&gt;拷贝公钥&lt;/h1&gt;

&lt;p&gt;Gitolite管理的方式是给你一个特殊的仓库，修改，提交，推送到服务器就可以了。&lt;br&gt;
这个仓库只可以管理员访问，先把管理员的公钥复制到服务器上(可以和Git服务器在同一台服务器上也可以在不同的服务器上)。&lt;/p&gt;

&lt;h2&gt;客户端执行&lt;/h2&gt;

&lt;p&gt;生成公钥weittor.pub，妥善保管好私钥weittor&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/.ssh/
ssh-keygen -f weittor
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;拷贝管理员公钥weittor.pub到git服务器上&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;ssh-copy-id -i weittor.pub git@192.168.20.120
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;安装Gitolite&lt;/h1&gt;

&lt;h2&gt;服务端执行&lt;/h2&gt;

&lt;p&gt;在Git服务器上切换到git用户进行安装。&lt;br&gt;
切换到git用户&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;su - git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建gitolite安装目录&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;mkdir bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重命名管理员公钥weittor.pub&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;mv ~/.ssh/authorized_keys ~/weittor.pub
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;提示：authorized_keys为前一步通过ssh-copy-id命令传输过来的weittor.pub公钥&lt;/p&gt;

&lt;p&gt;从github上获取gitolite最新的源代码&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git clone git://github.com/sitaramc/gitolite.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;安装到~/bin目录&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;~/gitolite/install -to ~/bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;初始化gitolite的git库&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;~/bin/gitolite setup -pk ~/weittor.pub
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;安装已经完成了，可以再以管理用户进行测试(前面运行ssh-copy-id的服务器)&lt;/p&gt;

&lt;h1&gt;测试&lt;/h1&gt;

&lt;h2&gt;客户端执行&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;ssh git@192.168.20.120
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;应该看到类似这样的输出:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;PTY allocation request failed on channel 0&lt;br&gt;
hello weittor, this is git@gitserver running gitolite3 v3.5.3.1-13-gb23aed9 on git 1.7.1&lt;br&gt;
            R W gitolite-admin&lt;br&gt;
            R W testing&lt;br&gt;
Connection to 192.168.20.120 closed.   &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;可以把管理仓库克隆下来管理Git服务器&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git clone git@192.168.20.120:gitolite-admin.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要添加用户，只要把用户的公钥复制到这个仓库里的keydir下并以username.pub命名，然后提交并推送到服务器。&lt;/p&gt;

&lt;h2&gt;添加用户示例(james)&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;gitolite-admin
cp ~/.ssh/james.pub keydir/james.pub
git add keydir
git commit -m &lt;span class=&quot;s2&quot;&gt;&amp;quot;add new user james&amp;quot;&lt;/span&gt;
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;创建仓库示例&lt;/h2&gt;

&lt;p&gt;创建一个名为wt-shell的仓库，james有读写权限&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;gitolite-admin
vi conf/gitolite.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;添加类似下面这内容进去&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;repo wt-shell    
    RW+    =   james
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;注释：赋予用户james以下权限R(读)、W(写)、+(强制推送)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;保存，提交并提交到git服务端&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git add conf
git commit -m &lt;span class=&quot;s1&quot;&gt;&amp;#39;add new repo wt-shell and assign RW+ to james&amp;#39;&lt;/span&gt;
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;推送的时候应该看到类似这样的信息&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Counting objects: 7, done.&lt;br&gt;
Delta compression using up to 4 threads.&lt;br&gt;
Compressing objects: 100% (3/3), done.&lt;br&gt;
Writing objects: 100% (4/4), 395 bytes, done.&lt;br&gt;
Total 4 (delta 1), reused 0 (delta 0)&lt;br&gt;
remote: Initialized empty Git repository in /home/git/repositories/wt-shell.git/&lt;br&gt;
To &lt;a href=&quot;mailto:git@192.168.20.120&quot;&gt;git@192.168.20.120&lt;/a&gt;:gitolite-admin&lt;br&gt;
   6de90b8..52737aa  master -&amp;gt; master   &lt;/p&gt;

&lt;p&gt;注释：remote开头的一行说明，git已经帮你创建了wt-shell仓库&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2&gt;通配符仓库的创建示例&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;说明：通配符仓库事先不能确定名字，所以不会帮你创建，在你clone的时候才会创建。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;编辑conf/gitolite.conf文件在里面加入类似下面的内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;repo sandbox/.+$    
  C      =   jack    
  RW+C   =   jack    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;注意:&lt;code&gt;C = username&lt;/code&gt;的一行必不可少，这里的C是指创建仓库的意思，下一行的RW+C中的C是指创建引用(branch,tag)的意思。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;保存后提交并推送到服务上去&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git add conf
git commit -m &lt;span class=&quot;s1&quot;&gt;&amp;#39;add sandbox repo&amp;#39;&lt;/span&gt;
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;注释：再次查看push时输出的信息，应该没有创建仓库的信息。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这时jack克隆仓库的时候会自动创建。&lt;br&gt;
使用jack用户执行如下命令&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git clone git@192.168.20.120:sandbox/test.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出应该类似这样&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Cloning into &amp;#39;test&amp;#39;...&lt;br&gt;
Initialized empty Git repository in /home/git/repositories/sandbox/test.git/&lt;br&gt;
warning: You appear to have cloned an empty repository.   &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;如果你的输出报这样的错&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;FATAL: R any sandbox/test jenny DENIED by fallthru&lt;br&gt;
(or you mis-spelled the reponame)&lt;br&gt;
fatal: The remote end hung up unexpectedly   &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;一般是因为没有&lt;code&gt;C=username&lt;/code&gt;这一行，注意是只有C的一行。&lt;/p&gt;

&lt;h1&gt;参考资料&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;http://williamherry.com/blog/2012/10/03/install-gitolite/&quot;&gt;http://williamherry.com/blog/2012/10/03/install-gitolite/&lt;/a&gt;     &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ginano.net/centos-gitolite-git-server&quot;&gt;http://www.ginano.net/centos-gitolite-git-server&lt;/a&gt;   &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.bigfastblog.com/gitolite-installation-step-by-step&quot;&gt;http://www.bigfastblog.com/gitolite-installation-step-by-step&lt;/a&gt;    &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.sina.com.cn/s/blog_6b61ec070101f44e.html&quot;&gt;http://blog.sina.com.cn/s/blog_6b61ec070101f44e.html&lt;/a&gt;   &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ossxp.com/doc/git/gitolite.html#id5&quot;&gt;http://www.ossxp.com/doc/git/gitolite.html#id5&lt;/a&gt;   &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://zengrong.net/post/1720.htm&quot;&gt;http://zengrong.net/post/1720.htm&lt;/a&gt;   &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://aeturnalus.com/software/redmine-git-hosting-setup-ubuntu-12-04-lts/&quot;&gt;http://aeturnalus.com/software/redmine-git-hosting-setup-ubuntu-12-04-lts/&lt;/a&gt;    &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://roclinux.cn/?p=2553&quot;&gt;http://roclinux.cn/?p=2553&lt;/a&gt;   &lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>CentOS系统搭建主从DNS服务</title>
        <link href="http://blog.weittor.com/set-up-master-slave-dns-service-on-centos.html"/>
        <updated>2014-04-20T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/set-up-master-slave-dns-service-on-centos</id>
        <content type="html">&lt;hr&gt;

&lt;p&gt;&lt;em&gt;通过bind搭建DNS主从服务器&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;主DNS server配置&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;IP地址：192.168.122.101 &lt;/p&gt;

&lt;p&gt;FQDN：122-101.weittor-inc.com&lt;br&gt;
操作系统：Centos6.4&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;辅DNS server配置&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;IP地址：192.168.122.102 
FQDN： 122-102.weittor-inc.com&lt;br&gt;
操作系统：Centos6.4&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;h1&gt;前期准备&lt;/h1&gt;

&lt;h2&gt;安装centos&lt;/h2&gt;

&lt;p&gt;[略]&lt;/p&gt;

&lt;h2&gt;禁用selinux&lt;/h2&gt;

&lt;p&gt;[略]&lt;/p&gt;

&lt;h2&gt;禁用iptables&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    /etc/init.d/iptables stop
    chkconfig  iptables off   //开机永久关闭
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;填写完整的/etc/hosts配置&lt;/h2&gt;

&lt;p&gt;[略]&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1&gt;主DNS服务器配置[Master DNS Server]&lt;/h1&gt;

&lt;h2&gt;安装bind&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    yum install &lt;span class=&quot;nb&quot;&gt;bind&lt;/span&gt;-*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置文件&lt;/h2&gt;

&lt;h3&gt;配置文件概览&lt;/h3&gt;

&lt;p&gt;创建的配置文件列表如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    ls /var/named
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    localtime      
    named.rfc1912.zones
    bak-named.online.zones
    named.conf     
    rndc.conf
    bind.keys          
    named.online.zones
    zones
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编辑主配置文件named.conf&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            listen-on port &lt;span class=&quot;m&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            listen-on-v6 port &lt;span class=&quot;m&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; ::1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            directory       &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;##指定根目录&lt;/span&gt;
            dump-file       &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named/data/cache_dump.db&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            statistics-file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named/data/named_stats.txt&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            memstatistics-file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named/data/named_mem_stats.txt&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
                    192.168.122.102&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;##指定辅DNS服务器&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            allow-query     &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    127.0.0.1/8&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    192.168.122.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            recursion yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            dnssec-enable yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            dnssec-validation yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            dnssec-lookaside auto&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    /* Path to ISC DLV key */
    &lt;span class=&quot;c&quot;&gt;#       bindkeys-file &amp;quot;/etc/named.iscdlv.key&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#       managed-keys-directory &amp;quot;/var/named/dynamic&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;



    key &lt;span class=&quot;s2&quot;&gt;&amp;quot;rndc-key&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            algorithm hmac-md5&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            secret &lt;span class=&quot;s2&quot;&gt;&amp;quot;fUgKXu0t1woSwFfVB8xOTQ==&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;



    controls &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            inet 127.0.0.1 port 953
            allow &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; keys &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;rndc-key&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;



    &lt;span class=&quot;c&quot;&gt;#logging {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#        channel default_debug {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#                file &amp;quot;data/named.run&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#                severity dynamic;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#        };&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#};&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#zone &amp;quot;.&amp;quot; IN {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#       type hint;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#       file &amp;quot;named.ca&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#};&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#include &amp;quot;/etc/named.rfc1912.zones&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#include &amp;quot;/etc/named.root.key&amp;quot;;&lt;/span&gt;
    logging&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            channel simple_log &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/log/bind.log&amp;quot;&lt;/span&gt; versions &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt; size 50m&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    severity info&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-time yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-severity yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-category yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            category default&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    simple_log&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            channel queries_log &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/log/bind_queries.log&amp;quot;&lt;/span&gt; versions &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt; size 50m&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-time yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-severity yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-category yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            category queries &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    queries_log&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            category lame-servers &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;



    zone &lt;span class=&quot;s2&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt; IN &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;hint&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
            file &lt;span class=&quot;s2&quot;&gt;&amp;quot;named.ca&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;##域名根域配置文件&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    include &lt;span class=&quot;s2&quot;&gt;&amp;quot;etc/named.online.zones&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;##指定在线域名配置文件&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;生成根域配置文件named.ca&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    wget http://www.internic.net/domain/named.root -O named.ca
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编辑线上域列表配置文件named.online.zones&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    zone &lt;span class=&quot;s2&quot;&gt;&amp;quot;weittor-inc.com&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            file &lt;span class=&quot;s2&quot;&gt;&amp;quot;weittor-inc.com.zone&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;##正向域名配置文件&lt;/span&gt;
            allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                192.168.122.102&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            notify explicit&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            also-notify &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                192.168.122.102&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;



    zone &lt;span class=&quot;s2&quot;&gt;&amp;quot;168.192.in-addr.arpa.&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&amp;quot;168.192.in-addr.arpa.zone&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;##反向域名配置文件&lt;/span&gt;
        allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            192.168.122.102&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            notify explicit&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            also-notify &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            192.168.122.102&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编辑zone分区文件&lt;/h3&gt;

&lt;h4&gt;编辑正向解析配置文件weittor.com.zone&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    &lt;span class=&quot;nv&quot;&gt;$ORIGIN&lt;/span&gt; .
    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 600&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes
    weittor-inc.comIN SOAns1.weittor-inc.com. domain.weittor-inc.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;m&quot;&gt;2014040101&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; serial
    &lt;span class=&quot;m&quot;&gt;10800&lt;/span&gt;      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; refresh &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; hours&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;m&quot;&gt;600&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; retry &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;m&quot;&gt;604800&lt;/span&gt;     &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; expire &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; week&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;m&quot;&gt;60&lt;/span&gt;         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; minimum &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; minute&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 43200&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;12&lt;/span&gt; hours
    NS  ns1.weittor-inc.com.
    NS  ns2.weittor-inc.com.
    A   192.168.122.13




    &lt;span class=&quot;nv&quot;&gt;$ORIGIN&lt;/span&gt; weittor-inc.com.
    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 43200&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;12&lt;/span&gt; hours
    &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;TYPE A


    ns1 A   192.168.122.101
    ns2 A   192.168.122.102


    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 600&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes
    mx1 A   192.168.122.65
    mx2 A   192.168.122.66

    blog    A   192.168.122.132
    book    A   192.168.122.133


    &lt;span class=&quot;nv&quot;&gt;$ORIGINn&lt;/span&gt;.weittor-inc.com.
    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 600&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes
    &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;TYPE A

    a   A   192.168.122.13

    &lt;span class=&quot;nv&quot;&gt;$ORIGIN&lt;/span&gt; weittor-inc.com.
    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;600&lt;/span&gt;         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes
    &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;TYPE CNAME


    www CNAME   a.n.weittor-inc.com.
    tech    CNAME   a.n.weittor-inc.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;编辑反向解析配置文件168.192.in-addr.arpa.zone&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    &lt;span class=&quot;nv&quot;&gt;$ORIGIN&lt;/span&gt; .
    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;600&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes
    168.192.in-addr.arpa      IN SOA  ns1.weittor-inc.com. domain.weittor-inc.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                                    &lt;span class=&quot;m&quot;&gt;2014022001&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; serial
                                    &lt;span class=&quot;m&quot;&gt;10800&lt;/span&gt;      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; refresh &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; hours&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;m&quot;&gt;600&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; retry &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; minutes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;m&quot;&gt;604800&lt;/span&gt;     &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; expire &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; week&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;m&quot;&gt;60&lt;/span&gt;         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; minimum &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; minute&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

                            NS      ns2.weittor-inc.com.
                            NS      ns1.weittor-inc.com.

    &lt;span class=&quot;nv&quot;&gt;$ORIGIN&lt;/span&gt; 168.192.in-addr.arpa.
    &lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;600&lt;/span&gt;      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; hour

    65.122                   PTR     122-65.weittor-inc.com.
    66.122                   PTR     122-66.weittor-inc.com.
    13.122                   PTR     122-13.weittor-inc.com.
    132.122                   PTR     122-132.weittor-inc.com.
    133.122                   PTR     122-133.weittor-inc.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;启动服务&lt;/h2&gt;

&lt;h3&gt;检查配置文件是否正确&lt;/h3&gt;

&lt;p&gt;使用命令named-checkconf有关配置&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    named-checkzone weittor-inc.com weittor-inc.com.zone
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;检查配置文件正确的话，启动服务。&lt;/p&gt;

&lt;h3&gt;启动进程&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    service named restart
    chkconfig named on //开机开启
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;测试&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    nslookup www.weittor-inc.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;//查询到正确地址ok的话，说明配置成功&lt;/p&gt;

&lt;h1&gt;辅DNS服务器配置[Slave DNS Server]&lt;/h1&gt;

&lt;h2&gt;安装bind&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    yum install &lt;span class=&quot;nb&quot;&gt;bind&lt;/span&gt;-*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置文件&lt;/h2&gt;

&lt;h3&gt;配置文件概览&lt;/h3&gt;

&lt;p&gt;需要创建的配置文件列表如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    ls /var/named
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    localtime      
    named.rfc1912.zones
    bak-named.online.zones
    named.conf     
    rndc.conf
    bind.keys          
    named.online.zones
    zones
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编辑主配置文件named.conf&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            listen-on port &lt;span class=&quot;m&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            listen-on-v6 port &lt;span class=&quot;m&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; ::1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            directory       &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            dump-file       &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named/data/cache_dump.db&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            statistics-file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named/data/named_stats.txt&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            memstatistics-file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/named/data/named_mem_stats.txt&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    192.168.122.102&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            allow-query     &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    127.0.0.1/8&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    192.168.122.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            recursion yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            dnssec-enable yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            dnssec-validation yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            dnssec-lookaside auto&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    /* Path to ISC DLV key */
    &lt;span class=&quot;c&quot;&gt;#       bindkeys-file &amp;quot;/etc/named.iscdlv.key&amp;quot;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#       managed-keys-directory &amp;quot;/var/named/dynamic&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;


    key &lt;span class=&quot;s2&quot;&gt;&amp;quot;rndc-key&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            algorithm hmac-md5&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            secret &lt;span class=&quot;s2&quot;&gt;&amp;quot;fUgKXu0t1woSwFfVB8xOTQ==&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    controls &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            inet 127.0.0.1 port 953
            allow &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; keys &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;rndc-key&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#logging {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#        channel default_debug {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#                file &amp;quot;data/named.run&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#                severity dynamic;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#        };&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#};&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#zone &amp;quot;.&amp;quot; IN {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#       type hint;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#       file &amp;quot;named.ca&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#};&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#include &amp;quot;/etc/named.rfc1912.zones&amp;quot;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#include &amp;quot;/etc/named.root.key&amp;quot;;&lt;/span&gt;
    logging&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            channel simple_log &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/log/bind.log&amp;quot;&lt;/span&gt; versions &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt; size 50m&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    severity info&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-time yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-severity yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-category yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            category default&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    simple_log&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            channel queries_log &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    file &lt;span class=&quot;s2&quot;&gt;&amp;quot;/var/log/bind_queries.log&amp;quot;&lt;/span&gt; versions &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt; size 50m&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-time yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                    print-severity yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    print-category yes&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            category queries &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    queries_log&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            category lame-servers &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    zone &lt;span class=&quot;s2&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt; IN &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;hint&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            file &lt;span class=&quot;s2&quot;&gt;&amp;quot;named.ca&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    include &lt;span class=&quot;s2&quot;&gt;&amp;quot;etc/named.online.zones&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编辑named.online.zones配置文件&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    zone &lt;span class=&quot;s2&quot;&gt;&amp;quot;weittor-inc.com&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;slave&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            file &lt;span class=&quot;s2&quot;&gt;&amp;quot;slaves/weittor-inc.com.zone&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            masters &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            allow-notify &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;





    zone &lt;span class=&quot;s2&quot;&gt;&amp;quot;168.192.in-addr.arpa.&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;slave&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;##指定该服务器角色为辅DNS服务器&lt;/span&gt;
            file &lt;span class=&quot;s2&quot;&gt;&amp;quot;slaves/168.192.in-addr.arpa.zone&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            masters &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;##指定主DNS服务器地址&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            allow-notify &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                     192.168.122.101&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;启动服务&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    service named restart
    chkconfig named on //开机开启
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看辅DNS服务器是否同步成功&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    ll var/named/slaves
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;客户端配置&lt;/h1&gt;

&lt;p&gt;设置client的DNS为刚刚搭建的DNS服务器&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    cat /etc/resolv.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;添加内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;    search weittor-inc.com
    nameserver 192.168.122.101
    nameserver 192.168.122.102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;测试&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;    nslookup www.weittor-inc.com
    dig www.weittor-inc.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;至此，配置过程结束。&lt;/p&gt;

&lt;h1&gt;参考资料&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;http://geekpeek.net/install-bind-centos/&quot;&gt;http://geekpeek.net/install-bind-centos/&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.centos.bz/2011/07/centos-install-bind-dns-server/&quot;&gt;http://www.centos.bz/2011/07/centos-install-bind-dns-server/&lt;/a&gt;&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>FastDFS集群安装部署[4]:部署Nginx服务</title>
        <link href="http://blog.weittor.com/install-fastdfs-cluster-deployment-4-deploy-nginx-service.html"/>
        <updated>2014-04-13T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/install-fastdfs-cluster-deployment-4-deploy-nginx-service</id>
        <content type="html">&lt;hr&gt;

&lt;h1&gt;FastDFS+Nginx图片存储方案&lt;/h1&gt;

&lt;p&gt;服务器IP规划&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;FastDFS storage server01    192.168.122.115  

FastDFS storage server02    192.168.122.116  

FastDFS tracker server01    192.168.122.113  

FastDFS client    192.168.122.120
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;架构图与Tracker Server的安装步骤请参考博文&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.weittor.com/fastdfs-cluster-deployment-1-installing-a-tracker-server.html&quot;&gt;FastDFS集群安装部署[1]:安装Tracker Server&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;Storage Server的安装步骤请参考博文&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.weittor.com/fastdfs-cluster-deployment-2-installing-storage-server.html&quot;&gt;FastDFS集群安装部署[2]:安装Storage Server&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;有关的tracker server的端口号信息如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;192.168.122.113:22122
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来，&lt;em&gt;chris.hill&lt;/em&gt;将为大家介绍访问FastDFS Web服务的Nginx搭建过程。&lt;/p&gt;

&lt;p&gt;结果：安装nginx作为web前端，通过HTTP访问后端FastDFS存储。  &lt;/p&gt;

&lt;p&gt;在storage上安装的nginx主要为了提供http的访问服务，同时解决group中storage服务器的同步延迟问题。&lt;/p&gt;

&lt;h1&gt;在FastDFS Storage上安装nginx&lt;/h1&gt;

&lt;p&gt;以下操作在&lt;code&gt;FastDFS storage server01    192.168.122.115&lt;/code&gt;服务器上执行&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h2&gt;安装依赖软件&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;yum -y install pcre-devel openssl openssl-devel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;下载nginx和fastdfs-nginx-module&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;install/
wget http://nginx.org/download/nginx-1.5.9.tar.gz
wget https://fastdfs-nginx-module.googlecode.com/files/fastdfs-nginx-module_v1.15.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将这两个软件scp到另外一个storage server节点以及track server节点。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;scp nginx-1.5.9.tar.gz fastdfs-nginx-module_v1.15.tar.gz 192.168.122.116:~/install
scp nginx-1.5.9.tar.gz fastdfs-nginx-module_v1.15.tar.gz 192.168.122.113:~/install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装nginx和fastdfs-nginx-module&lt;/h2&gt;

&lt;p&gt;解压&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;tar xvzf nginx-1.5.9.tar.gz
tar xvzf fastdfs-nginx-module_v1.15.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编译并安装nginx&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;nginx-1.5.9
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/nginx --add-module&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/root/install/fastdfs-nginx-module/src
make
make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将FastDFS的nginx插件模块的配置文件copy到FastDFS配置文件目录。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;cp ~/install/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编辑nginx.conf配置文件&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /usr/local/nginx/conf/nginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;设置添加storage server的配置并保存&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot; data-lang=&quot;nginx&quot;&gt;    &lt;span class=&quot;k&quot;&gt;......&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kn&quot;&gt;listen&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;9090&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kn&quot;&gt;server_name&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;......&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/group1/M00&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;kn&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/storage/data1/data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;kn&quot;&gt;ngx_fastdfs_module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;......&lt;/span&gt; 
    &lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建store_path的软连接&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ln -s /storage/data1/data /storage/data1/data/M00
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编辑/etc/fdfs下的配置文件mod_fastdfs.conf，添加storage信息。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /etc/fdfs/mod_fastdfs.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;修改相应的配置信息&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    ......

    # the base path to store log files
    base_path=/storage/data1
    ...
    # FastDFS tracker_server can ocur more than once, and tracker_server format is
    #  &amp;quot;host:port&amp;quot;, host can be hostname or ip address
    # valid only when load_fdfs_parameters_from_tracker is true
    tracker_server=192.168.122.113:22122

    # the port of the local storage server
    # the default value is 23000
    storage_server_port=23000
    # the group name of the local storage server
    group_name=group1
    # if the url / uri including the group name
    # set to false when uri like /M00/00/00/xxx
    # set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx
    # default value is false
    url_have_group_name = true

    # path(disk or mount point) count, default value is 1
    # must same as storage.conf
    store_path_count=1

    # store_path#, based 0, if store_path0 not exists, it&amp;#39;s value is base_path
    # the paths must be exist
    # must same as storage.conf
    store_path0=/storage/data1

    # set the group count
    # set to none zero to support multi-group
    # set to 0  for single group only
    # groups settings section as [group1], [group2], ..., [groupN]
    # default value is 0
    # since v1.14
    group_count = 1

    # group settings for group #1
    # since v1.14
    [group1]
    group_name=group1
    storage_server_port=23000
    store_path_count=1
    store_path0=/storage/data1


    ......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;测试并启动nginx服务&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;/usr/local/nginx/sbin/nginx -t
/usr/local/nginx/sbin/nginx
ps -ef&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;grep nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看nginx日志，看是否有错误&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;tail /usr/local/nginx/logs/error.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在error.log中没有错误，既启动成功。可以打开浏览器，直接访问&lt;a href=&quot;http://192.168.122.115:9090%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%BC%B9%E5%87%BAnginx%E6%AC%A2%E8%BF%8E%E9%A1%B5%E9%9D%A2%E3%80%82&quot;&gt;http://192.168.122.115:9090，查看是否弹出nginx欢迎页面。&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;设置开机自启动&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/local/nginx/sbin/nginx&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rc.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置另一个storage server&lt;/h2&gt;

&lt;p&gt;在192.168.122.116服务器上，也执行同样的操作。
安装并启动nginx服务。
在此忽略配置过程。&lt;/p&gt;

&lt;h1&gt;配置Track Server的nginx服务&lt;/h1&gt;

&lt;p&gt;在Tracker Server上安装的nginx主要是为了实现反向代理和负载均衡功能。&lt;/p&gt;

&lt;h2&gt;安装相关依赖&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;yum -y install pcre-devel openssl openssl-devel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装nginx&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;install/
tar xvzf nginx-1.5.9.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;nginx-1.5.9
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/nginx
make
make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置nginx&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /usr/local/nginx/conf/nginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;修改相应的配置信息如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-nginx&quot; data-lang=&quot;nginx&quot;&gt;    &lt;span class=&quot;k&quot;&gt;...&lt;/span&gt;

            &lt;span class=&quot;s&quot;&gt;upstream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fdfs_group1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;kn&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;192.168.122.115&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9090&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;weight=1&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;max_fails=2&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fail_timeout=30s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;kn&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;192.168.122.116&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9090&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;weight=1&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;max_fails=2&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fail_timeout=30s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kn&quot;&gt;listen&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kn&quot;&gt;server_name&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;localhost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kn&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/group1/M00&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;kn&quot;&gt;proxy_pass&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://fdfs_group1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kn&quot;&gt;....&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;启动nginx服务&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;/usr/local/nginx/sbin/nginx -t
/usr/local/nginx/sbin/nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;确认nginx服务启动正常&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ps -ef&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;grep nginx
tail -f /usr/local/nginx/logs/error.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;设置开机自启动&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/local/nginx/sbin/nginx&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rc.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;若日志里没有出现错误信息，之后可以进入下一步进行测试。&lt;/p&gt;

&lt;h1&gt;测试&lt;/h1&gt;

&lt;p&gt;在192.168.122.120客户端服务器上进行测试。
尝试上传一个文件到FastDFS，然后访问该文件。
配置client.conf文件。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /etc/fdfs/client.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;修改参数：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    base_path=/var/fdfs                #日志存放路径
    tracker_server=192.168.122.113:22122         #tracker server的IP地址和端口号
    http.tracker_server_port=8080              #tracker server的http端口号
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用/usr/local/bin/fdfs_upload_file上传一个文件，程序会自动返回文件的URL。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;fdfs_upload_file /etc/fdfs/client.conf weittor.com.1.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出信息&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;fdfs_upload_file /etc/fdfs/client.conf weittor.com.1.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出信息&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    group1/M00/00/00/wKh6dFNCM8eALk-aAAAAM0bdRic.1.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过浏览器访问该url，测试是否正常&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://192.168.122.113:8080/group1/M00/00/00/wKh6dFNCM8eALk-aAAAAM0bdRic.1.html&quot;&gt;http://192.168.122.113:8080/group1/M00/00/00/wKh6dFNCM8eALk-aAAAAM0bdRic.1.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;正常情况下返回该文件的内容，如下&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://www.weittor.com/wp-content/uploads/2014/04/2014-4-14_FastDFS-001_800x396.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;p&gt;至此，配置过程结束。&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>FastDFS集群安装部署[2]:安装Storage Server</title>
        <link href="http://blog.weittor.com/fastdfs-cluster-deployment-2-installing-storage-server.html"/>
        <updated>2014-04-12T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/fastdfs-cluster-deployment-2-installing-storage-server</id>
        <content type="html">&lt;hr&gt;

&lt;h1&gt;FastDFS+Nginx图片存储方案&lt;/h1&gt;

&lt;p&gt;服务器IP规划&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;FastDFS storage server01    192.168.122.115  

FastDFS storage server02    192.168.122.116  

FastDFS tracker server01    192.168.122.113  

FastDFS client    192.168.122.120
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;架构图与Tracker Server的安装步骤请参考博文&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.weittor.com/fastdfs-cluster-deployment-1-installing-a-tracker-server.html&quot;&gt;FastDFS集群安装部署[1]:安装Tracker Server&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;有关的tracker server的端口号信息如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;192.168.122.113:22122
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来，&lt;em&gt;chris.hill&lt;/em&gt;将为大家介绍FastDFS Storage Server的搭建过程。&lt;/p&gt;

&lt;h1&gt;部属FastDFS Tracker Server&lt;/h1&gt;

&lt;p&gt;以下操作在&lt;code&gt;FastDFS storage server01    192.168.122.115&lt;/code&gt;服务器上进行&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h2&gt;安装依赖软件包&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;yum install -y wget gcc make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装libevent网络库&lt;/h2&gt;

&lt;p&gt;FastDFS依赖开源网络库libevent，因此先安装它。  &lt;/p&gt;

&lt;p&gt;libevent的官方站点：&lt;a href=&quot;http://libevent.org/&quot;&gt;http://libevent.org/&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;下载最新版2.0.21版本。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkdir install   
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;install
wget &lt;span class=&quot;s2&quot;&gt;&amp;quot;https://github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz&amp;quot;&lt;/span&gt;
tar zxf libevent-2.0.21-stable.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;libevent-2.0.21-stable
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr  &lt;span class=&quot;c&quot;&gt;#编译&lt;/span&gt;
make    
make install    &lt;span class=&quot;c&quot;&gt;#安装&lt;/span&gt;
ldconfig    &lt;span class=&quot;c&quot;&gt;#加载更新动态库&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装FastDFS Storage Server&lt;/h2&gt;

&lt;p&gt;下载地址：(&lt;a href=&quot;http://code.google.com/p/fastdfs/&quot;&gt;http://code.google.com/p/fastdfs/&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ～/install/
wget http://fastdfs.googlecode.com/files/FastDFS_v4.06.tar.gz
tar xvzf FastDFS_v4.06.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;FastDFS
ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编辑安装配置文件make.sh&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim make.sh 
&lt;span class=&quot;c&quot;&gt;##取消WITH_LINUX_SERVICE=1选项前面的注释&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行安装&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./make.sh
./make.sh install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看fdfs进程启动选项&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;chkconfig --list &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; grep fdfs
&lt;span class=&quot;c&quot;&gt;#输出&lt;/span&gt;
fdfs_storaged   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
fdfs_trackerd   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置 FastDFS Storage Server&lt;/h2&gt;

&lt;p&gt;配置FastDFS Storage Server，需要修改 storage.conf 配置文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /etc/fdfs/storage.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;修改如下内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    ....... 
    # the base path to store data and log files
    base_path=/var/fdfs     ##配置主目录

    # store_path#, based 0, if store_path0 not exists, it&amp;#39;s value is base_path
    # the paths must be exist
    #store_path0=/home/yuqing/fastdfs
    #store_path1=/home/yuqing/fastdfs2
    store_path0=/storage/data1      ##数据原文件目录

    # tracker_server can ocur more than once, and tracker_server format is
    #  &amp;quot;host:port&amp;quot;, host can be hostname or ip address
    #tracker_server=192.168.209.121:22122
    tracker_server=192.168.122.113:22122    ##tracker server的端口信息
    ......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;需要创建FastDFS存储目录，否则无法启动&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkdir -p /var/fdfs
mkdir -p /storage/data1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;启动 FastDFS Storage Server&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;service fdfs_storaged start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出信息如下，可以看到创建目录的详细过程&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    data path: /storage/data1/data, mkdir sub dir...
    mkdir data path: 00 ...
    mkdir data path: 01 ...
    mkdir data path: 02 ...
    mkdir data path: 03 ...
    mkdir data path: 04 ...
    mkdir data path: 05 ...
    mkdir data path: 06 ...
    mkdir data path: 07 ...
    mkdir data path: 08 ...
    mkdir data path: 09 ...
    mkdir data path: 0A ...
    mkdir data path: 0B ...
    ........
    mkdir data path: BB ...
    mkdir data path: BC ...
    mkdir data path: BD ...
    mkdir data path: BE ...
    mkdir data path: BF ...
    mkdir data path: C0 ...
    mkdir data path: C1 ...
    mkdir data path: C2 ...
    mkdir data path: C3 ...
    mkdir data path: C4 ...
    mkdir data path: C5 ...
    mkdir data path: C6 ...
    mkdir data path: C7 ...
    mkdir data path: C8 ...
    mkdir data path: C9 ...
    ......
    mkdir data path: DD ...
    mkdir data path: DE ...
    mkdir data path: DF ...
    mkdir data path: E0 ...
    mkdir data path: E1 ...
    mkdir data path: E2 ...
    mkdir data path: E3 ...
    mkdir data path: E4 ...
    mkdir data path: E5 ...
    mkdir data path: E6 ...
    mkdir data path: E7 ...
    mkdir data path: E8 ...
    mkdir data path: E9 ...
    mkdir data path: EA ...
    mkdir data path: EB ...
    .......
    mkdir data path: FB ...
    mkdir data path: FC ...
    mkdir data path: FD ...
    mkdir data path: FE ...
    mkdir data path: FF ...
    data path: /storage/data1/data, mkdir sub dir done.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看fdfs_storaged服务是否已经正常启动&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;service fdfs_storaged status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;关闭 fdfs_trackerd服务。  &lt;/p&gt;

&lt;p&gt;因为FastDFS Storage Server服务器只需要启动 fdfs_storaged服务。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;chkconfig fdfs_trackerd off
chkconfig --list&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;grep fdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    fdfs_storaged   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
    fdfs_trackerd   0:关闭  1:关闭  2:关闭  3:关闭  4:关闭  5:关闭  6:关闭
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;到此为止，192.168.122.115服务器上的FastDFS Storage Server 已经安装完成并启动。&lt;/p&gt;

&lt;p&gt;之后，需要在第2个 FastDFS Storage Server 节点(&lt;code&gt;192.168.122.116&lt;/code&gt;)上执行相同的步骤，安装并启动 fdfs_storaged进程。&lt;/p&gt;

&lt;p&gt;停止进程，可以使用命令：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;service fdfs_storaged stop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;附录&lt;/h1&gt;

&lt;p&gt;storage.conf配置文件说明&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;配置说明转自51CTO，地址无法确认，不好意思
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    disabled=false
    #配置是否生效
    group_name=group1
    #storage所在组(卷)
    bind_addr=192.168.6.100
    # 绑定IP，另一太 storage IP为 192.168.6.101
    client_bind=true
    #bind_addr通常是针对server的。当指定bind_addr时，本参数才有效。
    port=23000
    # 是storage 服务端口
    connect_timeout=30
    # 连接超时时间，针对socket套接字函数connect
    network_timeout=60
    # storage server 网络超时时间，单位为秒。
    heart_beat_interval=30
    # 心跳间隔时间，单位为秒
    stat_report_interval=60
    # storage server向tracker server报告磁盘剩余空间的时间间隔，单位为秒。
    base_path=/home/eric
    # base_path 目录地址,根目录必须存在  子目录会自动生成
    # 会产生data（数据存储地方）、 logs日志文件
    max_connections=256
    # 最大连接数
    buff_size = 256KB
    # 设置队列结点的buffer大小。
    work_threads=4
    # 工作线程数
    disk_rw_separated = true
    # 磁盘IO读写是否分离，缺省是分离的。
    disk_reader_threads = 1
    # 针对单个存储路径的读线程数，缺省值为1
    disk_writer_threads = 1
    # 针对单个存储路径的写线程数，缺省值为1
    sync_wait_msec=200
    # 同步文件时，如果从binlog中没有读到要同步的文件，休眠N毫秒后重新读取，0表示不休眠，立即再次尝试读取。
    sync_interval=0
    #  同步上一个文件后，再同步下一个文件的时间间隔，单位为毫秒，0表示不休眠，直接同步下一个文件。
    sync_start_time=00:00
    sync_end_time=23:59
    # 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定，相信sa都会明白。
    write_mark_file_freq=500
    # 把storage的mark文件定期同步到磁盘的时间间隔，单位为秒
    store_path_count=1
    # 存放文件时storage server支持多个路径（例如磁盘）。这里配置存放文件的基路径数目，通常只配一个目录。
    store_path0=/home/eric
    #  逐一配置store_path个路径，索引号基于0。注意配置方法后面有0,1,2 ......，需要配置0到store_path - 1。
    # 如果不配置base_path0，那边它就和base_path对应的路径一样。
    subdir_count_per_path=32
    # FastDFS存储文件时，采用了两级目录。这里配置存放文件的目录个数
    tracker_server=192.168.6.188:22122
    # tracker_server 的列表 要写端口的哦
    log_level=info
    # 日志级别
    run_by_group=
    # 运行storage 用户组
    run_by_user=
    # 运行storage 用户
    allow_hosts=*
    # 允许连接IP列表
    file_distribute_path_mode=0
    # 文件在data目录下分散存储策略。
    # 0: 轮流存放
    # 1: 随机存储
    file_distribute_rotate_count=100
    # 当上面的参数file_distribute_path_mode配置为0（轮流存放方式）时，本参数有效。
    #当一个目录下的文件存放的文件数达到本参数值时，后续上传的文件存储到下一个目录中
    fsync_after_written_bytes=0
    # 当写入大文件时，每写入N个字节，调用一次系统函数fsync将内容强行同步到硬盘。0表示从不调用fsync
    sync_log_buff_interval=10
    # 同步或刷新日志信息到硬盘的时间间隔，单位为秒
    sync_binlog_buff_interval=60
    # 同步binglog（更新操作日志）到硬盘的时间间隔，单位为秒
    sync_stat_file_interval=300
    #　把storage的stat文件同步到磁盘的时间间隔，单位为秒。
    thread_stack_size=512KB
    ＃　线程栈的大小。FastDFS server端采用了线程方式。
    ＃　线程栈越大，一个线程占用的系统资源就越多。
    upload_priority=10
    本storage server作为源服务器，上传文件的优先级，可以为负数。值越小，优先级越高。这里就和 tracker.conf 中store_server= 2时的配置相对应了
    if_alias_prefix=
    check_file_duplicate=0
    ＃　是否检测上传文件已经存在。如果已经存在，则不存在文件内容，建立一个符号链接以节省磁盘空间。　结合　fastdfh使用的。 1是检测，0是不检测，我们不使用fastdfh 当然 0　
    key_namespace=FastDFS
    # 当上个参数设定为1 或 yes时 (true/on也是可以的) ， 在FastDHT中的命名空间
    keep_alive=0
    # 与FastDHT servers 的连接方式 (是否为持久连接)

    # 下面是http的配置了就不多说了
    http.disabled=true
    http.domain_name=
    http.server_port=80
    http.trunk_size=256KB
    http.need_find_content_type=true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>FastDFS集群安装部署[3]:安装FastDFS Client</title>
        <link href="http://blog.weittor.com/fastdfs-cluster-deployment-3-installing-fastdfs-client.html"/>
        <updated>2014-04-11T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/fastdfs-cluster-deployment-3-installing-fastdfs-client</id>
        <content type="html">&lt;hr&gt;

&lt;h1&gt;FastDFS+Nginx图片存储方案&lt;/h1&gt;

&lt;p&gt;服务器IP规划&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;FastDFS storage server01    192.168.122.115  

FastDFS storage server02    192.168.122.116  

FastDFS tracker server01    192.168.122.113  

FastDFS client    192.168.122.120
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;架构图与Tracker Server的安装步骤请参考博文&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.weittor.com/fastdfs-cluster-deployment-1-installing-a-tracker-server.html&quot;&gt;FastDFS集群安装部署[1]:安装Tracker Server&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;Storage Server的安装步骤请参考博文&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.weittor.com/fastdfs-cluster-deployment-2-installing-storage-server.html&quot;&gt;FastDFS集群安装部署[2]:安装Storage Server&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;有关的tracker server的端口号信息如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;192.168.122.113:22122
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来，&lt;em&gt;chris.hill&lt;/em&gt;将为大家介绍FastDFS Client的搭建过程。&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h1&gt;部属FastDFS Client&lt;/h1&gt;

&lt;p&gt;以下操作在&lt;code&gt;FastDFS client    192.168.122.120&lt;/code&gt; 服务器上进行&lt;/p&gt;

&lt;h2&gt;安装依赖软件包&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;yum install -y wget gcc make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装libevent网络库&lt;/h2&gt;

&lt;p&gt;FastDFS依赖开源网络库libevent，因此先安装它。  &lt;/p&gt;

&lt;p&gt;libevent的官方站点：&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://libevent.org/&quot;&gt;http://libevent.org/&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;下载最新版2.0.21版本。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkdir install
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;install
wget &lt;span class=&quot;s2&quot;&gt;&amp;quot;https://github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz&amp;quot;&lt;/span&gt;
tar zxf libevent-2.0.21-stable.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;libevent-2.0.21-stable
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr
make
make install
ldconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装FastDFS Client&lt;/h2&gt;

&lt;p&gt;下载地址：&lt;a href=&quot;http://code.google.com/p/fastdfs/&quot;&gt;http://code.google.com/p/fastdfs/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ～/install/
wget http://fastdfs.googlecode.com/files/FastDFS_v4.06.tar.gz
tar xvzf FastDFS_v4.06.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;FastDFS
ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编辑安装配置文件make.sh&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim make.sh
&lt;span class=&quot;c&quot;&gt;##取消WITH_LINUX_SERVICE=1选项前面的注释&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行安装&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./make.sh
./make.sh install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看fdfs进程启动选项&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;chkconfig --list &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; grep fdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    fdfs_storaged   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
    fdfs_trackerd   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;取消 fdfs_trackerd和fdfs_storaged开机自启动选项&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;chkconfig fdfs_storaged off
chkconfig fdfs_trackerd off
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;修改客户端配置&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /etc/fdfs/client.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编辑配置如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    # the base path to store log files
    #base_path=/home/yuqing/fastdfs
    base_path=/var/fastdfs

    # tracker_server can ocur more than once, and tracker_server format is
    #  &amp;quot;host:port&amp;quot;, host can be hostname or ip address
    #tracker_server=192.168.0.197:22122
    tracker_server=192.168.122.113:22122    ##Tracker Server端口号信息
    ......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建数据存储目录&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkdir -p /var/fastdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;测试上传，FastDFS为我们提供了名为fdfs_test的测试工具&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;fdfs_test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    This is FastDFS client test program v4.06

    Copyright (C) 2008, Happy Fish / YuQing

    FastDFS may be copied only under the terms of the GNU General
    Public License V3, which may be found in the FastDFS source kit.
    Please visit the FastDFS Home Page http://www.csource.org/
    for more detail.

    Usage: fdfs_test &amp;lt;config_file&amp;gt; &amp;lt;operation&amp;gt;
            operation: upload, download, getmeta, setmeta, delete and query_servers
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;先创建一个简单的文件weittor.com.txt，然后使用fdfs_test上传到FastDFS。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Hello FastDFS&amp;quot;&lt;/span&gt; &amp;gt;weittor.com.txt    &lt;span class=&quot;c&quot;&gt;##创建测试文件weittor.com.txt&lt;/span&gt;
fdfs_test /etc/fdfs/client.conf upload weittor.com.txt    &lt;span class=&quot;c&quot;&gt;##上传测试文件&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出信息如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    This is FastDFS client test program v4.06

    Copyright (C) 2008, Happy Fish / YuQing

    FastDFS may be copied only under the terms of the GNU General
    Public License V3, which may be found in the FastDFS source kit.
    Please visit the FastDFS Home Page http://www.csource.org/
    for more detail.

    [2014-04-05 20:08:24] DEBUG - base_path=/var/fdfs, connect_timeout=30, network_timeout=60, tracker_server_count=2, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0

    tracker_query_storage_store_list_without_group:
            server 1. group_name=, ip_addr=192.168.122.115, port=23000
            server 2. group_name=, ip_addr=192.168.122.116, port=23000

    group_name=group1, ip_addr=192.168.122.115, port=23000
    storage_upload_by_filename
    group_name=group1, remote_filename=M00/00/00/wKh6c1M_8jiAP8XfAAAADpNIeWE786.txt
    source ip address: 192.168.122.115
    file timestamp=2014-04-05 20:08:24
    file size=14
    file crc32=2471000417
    file url: http://192.168.122.113:8080/group1/M00/00/00/wKh6c1M_8jiAP8XfAAAADpNIeWE786.txt
    storage_upload_slave_by_filename
    group_name=group1, remote_filename=M00/00/00/wKh6c1M_8jiAP8XfAAAADpNIeWE786_big.txt
    source ip address: 192.168.122.115
    file timestamp=2014-04-05 20:08:24
    file size=14
    file crc32=2471000417
    file url: http://192.168.122.113:8080/group1/M00/00/00/wKh6c1M_8jiAP8XfAAAADpNIeWE786_big.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意上面fdfs_test upload执行输出的信息。
将weittor.com.txt上传至 FastDFS 之后，存储信息如下：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    group_name=group1, 
    remote_filename=M00/00/00/wKh6c1M_8jiAP8XfAAAADpNIeWE786.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在 fdfs_test download 中需要用到这两个信息。&lt;/p&gt;

&lt;p&gt;测试下载。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;fdfs_test /etc/fdfs/client.conf download group1 M00/00/00/wK                        h6c1M_8jiAP8XfAAAADpNIeWE786.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出信息如下：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    This is FastDFS client test program v4.06

    Copyright (C) 2008, Happy Fish / YuQing

    FastDFS may be copied only under the terms of the GNU General
    Public License V3, which may be found in the FastDFS source kit.
    Please visit the FastDFS Home Page http://www.csource.org/
    for more detail.

    [2014-04-05 20:11:45] DEBUG - base_path=/var/fdfs, connect_timeout=30, network_t                                                                                        imeout=60, tracker_server_count=2, anti_steal_token=0, anti_steal_secret_key len                                                                                        gth=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage                                                                                        _id=0, storage server id count: 0

    storage=192.168.122.115:23000
    download file success, file size=14, file save to wKh6c1M_8jiAP8XfAAAADpNIeWE786                                                                                        .txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看该文件的内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ls
&lt;span class=&quot;c&quot;&gt;##wKh6c1M_8jiAP8XfAAAADpNIeWE786.txt&lt;/span&gt;
cat wKh6c1M_8jiAP8XfAAAADpNIeWE786.txt
&lt;span class=&quot;c&quot;&gt;##Hello FastDFS&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从上面的测试可以看出，上传和下载都成功了。&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>FastDFS集群安装部署[1]:安装Tracker Server</title>
        <link href="http://blog.weittor.com/fastdfs-cluster-deployment-1-installing-a-tracker-server.html"/>
        <updated>2014-04-09T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/fastdfs-cluster-deployment-1-installing-a-tracker-server</id>
        <content type="html">&lt;hr&gt;

&lt;h1&gt;FastDFS+Nginx图片存储方案&lt;/h1&gt;

&lt;p&gt;FastDFS是一个开源的轻量级分布式文件系统，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载）等，解决了大容量存储和负载均衡的问题。特别适合应用于以文件为载体的在线服务，如相册网站、视频网站等。  &lt;/p&gt;

&lt;p&gt;FastDFS服务端有两个角色：跟踪器（tracker server）和存储节点（storage server）。  &lt;/p&gt;

&lt;p&gt;跟踪器主要起调度工作，在访问上起负载均衡的作用。存储节点用于存储数据，直接向前端服务提供数据。&lt;/p&gt;

&lt;p&gt;接下来，&lt;em&gt;chris.hill&lt;/em&gt;将通过实例为大家介绍有关FastDFS集群的搭建过程。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;服务器IP规划&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;FastDFS storage server01    192.168.122.115&lt;br&gt;
FastDFS storage server02    192.168.122.116&lt;br&gt;
FastDFS tracker server01    192.168.122.113&lt;br&gt;
FastDFS client    192.168.122.120&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;架构图如下&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2014year/2014040701.FastDFS.Cluster.Arch.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;h1&gt;部属FastDFS Tracker Server&lt;/h1&gt;

&lt;p&gt;以下操作在&lt;code&gt;FastDFS tracker server01    192.168.122.113&lt;/code&gt;服务器上进行&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h2&gt;安装依赖软件包&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;yum install -y wget gcc make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装libevent网络库&lt;/h2&gt;

&lt;p&gt;FastDFS依赖开源网络库libevent，因此先安装它。  &lt;/p&gt;

&lt;p&gt;libevent的官方站点：&lt;a href=&quot;http://libevent.org/&quot;&gt;http://libevent.org/&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;下载并安装最新版。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkdir install   &lt;span class=&quot;c&quot;&gt;#创建目录&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;install
wget &lt;span class=&quot;s2&quot;&gt;&amp;quot;https://github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz&amp;quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;##下载&lt;/span&gt;
tar zxf libevent-2.0.21-stable.tar.gz   &lt;span class=&quot;c&quot;&gt;#解压&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;libevent-2.0.21-stable
./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr  &lt;span class=&quot;c&quot;&gt;#编译&lt;/span&gt;
make
make install    &lt;span class=&quot;c&quot;&gt;#安装&lt;/span&gt;
ldconfig    &lt;span class=&quot;c&quot;&gt;#使相关库依赖生效&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;安装FastDFS Tracker Server&lt;/h2&gt;

&lt;p&gt;下载地址：(&lt;a href=&quot;http://code.google.com/p/fastdfs/&quot;&gt;http://code.google.com/p/fastdfs/&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ～/install/
wget http://fastdfs.googlecode.com/files/FastDFS_v4.06.tar.gz   &lt;span class=&quot;c&quot;&gt;#下载&lt;/span&gt;
tar xvzf FastDFS_v4.06.tar.gz   &lt;span class=&quot;c&quot;&gt;#解压&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;FastDFS
ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编辑安装配置文件make.sh&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim make.sh
&lt;span class=&quot;c&quot;&gt;###取消WITH_LINUX_SERVICE=1选项前面的注释&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;提示&lt;/em&gt;:新版的FastDFS去掉了内置的HTTP服务，因此无需修改有关HTTP服务的配置  &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;执行安装&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./make.sh
./make.sh install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看fdfs进程启动选项&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;chkconfig --list &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; grep fdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    fdfs_storaged   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
    fdfs_trackerd   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;fastdfs默认的配置文件被放置在/etc/fdfs目录下面，包含了
&lt;em&gt;client.conf  http.conf  mime.types  storage.conf  tracker.conf&lt;/em&gt;这五个文件。  &lt;/p&gt;

&lt;p&gt;fastdfs进程的启动是以加载的配置文件区分的。&lt;/p&gt;

&lt;h2&gt;配置FastDFS Tracker Server&lt;/h2&gt;

&lt;p&gt;FastDFS的配置文件在/etc/fdfs目录下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ls /etc/fdfs
client.conf  http.conf  mime.types  storage.conf  tracker.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置文件定义&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    client.conf    客户端上传配置文件
    storage.conf    文件存储服务器配置文件
    tracker.conf    负责均衡调度服务器配置文件
    http.conf        http服务器配置文件
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;修改 tracker.conf
配置FastDFS Tracker Server，需要修改 tracker.conf 配置文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;vim /etc/fdfs/tracker.conf
...
&lt;span class=&quot;c&quot;&gt;# the base path to store data and log files&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 数据和日志的存储目录，需要自行创建该目录&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;base_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/fdfs
...

&lt;span class=&quot;c&quot;&gt;# HTTP port on this tracker server&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#HTTP服务的端口号&lt;/span&gt;
http.server_port&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;9090
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;提示：其他配置选项保持默认。新版的FastDFS去掉的内置的HTTP server，因此后续需要集成nginx作为默认的http server。&lt;/p&gt;

&lt;p&gt;创建数据存储目录&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkdir -p /var/fdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;启动fdfs_trackerd服务&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;service fdfs_trackerd start
Starting FastDFS tracker server:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意：执行脚本既不会显示成功也不会显示失败，所以需要确认一下状态。&lt;/p&gt;

&lt;p&gt;确认fdfs_trackerd是否已经正常启动&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;service fdfs_trackerd status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看fdfs_trackerd的日志&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;tail -f /var/fastdfs/logs/trackerd.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;关闭fdfs_storaged 服务。因为这台机器上只需要启动 fdfs_trackerd 服务。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;chkconfig fdfs_storaged off
chkconfig --list &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; grep fdfs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    fdfs_storaged   0:关闭  1:关闭  2:关闭  3:关闭  4:关闭  5:关闭  6:关闭
    fdfs_trackerd   0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最后，查看一下FastDFS存储目录里面的内容&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ls /var/fastdfs/
data  logs
tree /var/fastdfs/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;到此为止，192.168.122.113服务器上的FastDFS Tracker Server 已经安装完成并启动。&lt;/p&gt;

&lt;p&gt;停止进程，可以使用命令：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;service fdfs_trackerd stop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;下一步我们将部署FastDFS Storage Server ，请参考后续博文。&lt;/p&gt;

&lt;h1&gt;附录&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;配置说明转载于51CTO博客，具体哪位童鞋写的，找不到了，不好意思。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;tracker.conf配置文件说明&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    disabled=false
    #配置是否生效
    bind_addr=192.168.6.102
    #绑定IP
    port=22122
    #服务端口
    connect_timeout=30
    #连接超时时间
    network_timeout=60
    #  tracker server的网络超时，单位为秒。
    base_path=/home/yangzi
    #目录地址，里面会创建data(存放存储服务器信息)、logs，日志文件
    max_connections=256
    #系统提供服务最大连接数
    work_threads=4
    #线程数，通常设置CPU数
    store_lookup=2
    #上传组(卷) 的方式 0:轮询方式 1: 指定组 2: 平衡负载(选择最大剩余空间的组(卷)上传)
    #这里如果在应用层指定了上传到一个固定组,那么这个参数被绕过
    store_group=group1
    #当上一个参数设定为1 时 (store_lookup=1，即指定组名时)，必须设置本参数为系统中存在的一个组名。如果选择其他的上传方式，这个参数就没有效了
    store_server=0
    #选择哪个storage server 进行上传操作(一个文件被上传后，这个storage server就相当于这个文件的storage server源，会对同组的storage server推送这个文件达到同步效果)
    # 0: 轮询方式
    # 1: 根据ip 地址进行排序选择第一个服务器（IP地址最小者）
    # 2: 根据优先级进行排序（上传优先级由storage server来设置，参数名为upload_priority）
    store_path=0
    #选择storage server 中的哪个目录进行上传。storage server可以有多个存放文件的base path（可以理解为多个磁盘）。
    # 0: 轮流方式，多个目录依次存放文件
    # 2: 选择剩余空间最大的目录存放文件（注意：剩余磁盘空间是动态的，因此存储到的目录或磁盘可能也是变化的）
    download_server=0
    #选择哪个 storage server 作为下载服务器
    # 0: 轮询方式，可以下载当前文件的任一storage server
    # 1: 哪个为源storage server 就用哪一个 (前面说过了这个storage server源 是怎样产生的) 就是之前上传到哪个storage server服务器就是哪个了
    reserved_storage_space = 4GB
    #storage server 上保留的空间,保证系统或其他应用需求空间(指出 如果同组的服务器的硬盘大小一样,以最小的为准,也就是只要同组中有一台服务器达到这个标准了,这个标准就生效,原因就是因为他们进行备份)
    log_level=info
    #选择日志级别
    run_by_group=
    #操作系统运行FastDFS的用户组
    run_by_user=
    #操作系统运行FastDFS的用户
    allow_hosts=*
    #可以连接到此 tracker server 的ip范围（对所有类型的连接都有影响，包括客户端，storage server）
    sync_log_buff_interval = 10
    # 同步或刷新日志信息到硬盘的时间间隔，单位为秒
    # 注意：tracker server 的日志不是时时写硬盘的，而是先写内存。
    check_active_interval = 120
    # 检测 storage server 存活的时间隔，单位为秒。
    # storage server定期向tracker server 发心跳，如果tracker server在一个check_active_interval内还没有收到storage server的一次心跳，那边将认为该storage server已经下线。所以本参数值必须大于storage server配置的心跳时间间隔。通常配置为storage server心跳时间间隔的2倍或3倍。
    thread_stack_size = 64KB
    # 线程栈的大小。FastDFS server端采用了线程方式。更正一下，tracker server线程栈不应小于64KB，不是512KB。
    # 线程栈越大，一个线程占用的系统资源就越多。如果要启动更多的线程（V1.x对应的参数为max_connections，
    V2.0为work_threads），可以适当降低本参数值。
    storage_ip_changed_auto_adjust = true
    # 这个参数控制当storage server IP地址改变时，集群是否自动调整。注：只有在storage server进程重启时才完成自动调整。
    storage_sync_file_max_delay = 86400
    # V2.0引入的参数。存储服务器之间同步文件的最大延迟时间，缺省为1天。根据实际情况进行调整
    storage_sync_file_max_time = 300
    # V2.0引入的参数。存储服务器同步一个文件需要消耗的最大时间，缺省为300s，即5分钟。
    http.disabled=true
    # HTTP服务是否不生效 当然编译的时候我已经把 with_httpd宏去掉了，
    http.server_port=80
    # HTTP服务端口
    # 下列参数只有 开启http服务才有用
    http.check_alive_interval=30
    http.check_alive_type=tcp
    http.check_alive_uri=/status.html
    http.need_find_content_type=true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    
    <entry>
        <title>在DHCP环境下配置VirtualBox虚拟机网络</title>
        <link href="http://blog.weittor.com/configuring-virtualbox-in-a-dhcp-environment-network.html"/>
        <updated>2013-12-22T00:00:00+08:00</updated>
        <id>http://blog.weittor.com/configuring-virtualbox-in-a-dhcp-environment-network</id>
        <content type="html">&lt;hr&gt;

&lt;h1&gt;需求&lt;/h1&gt;

&lt;p&gt;&lt;em&gt;chris.hill&lt;/em&gt;办公环境的宿主机使用的是办公室的&lt;em&gt;DHCP&lt;/em&gt;网络，需要配置VirtualBox虚拟机使其能够通过办公室的&lt;em&gt;DHCP&lt;/em&gt;网络获取&lt;em&gt;IP地址&lt;/em&gt;，从而达到能够同时访问内网和外网的目的。&lt;/p&gt;

&lt;p&gt;以下是简要的配置步骤。&lt;/p&gt;

&lt;h1&gt;步骤&lt;/h1&gt;

&lt;p&gt;1.打开VirtualBox虚拟机网络配置界面&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013year/2013-12-22_how-to-configure-the-virtualbox-network-during-dhcp-env01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;2.点击左侧的&amp;quot;网络&amp;quot;选项卡
编辑第一块网络的&amp;quot;连接方式&amp;quot;为&amp;quot;桥接网卡&amp;quot;
并将&amp;quot;界面名称&amp;quot;选择为&amp;quot;第一块物理网卡的名字&amp;quot;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013year/2013-12-22_how-to-configure-the-virtualbox-network-during-dhcp-env02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;p&gt;3.保存退出
在虚拟机内设置IP地址为DHCP自动获取的方式，并重启网络配置，即可获取相应的IP配置信息。&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;作者：chris hill&lt;/p&gt;

&lt;p&gt;微博：&lt;a href=&quot;http://www.weibo.com/weittor&quot;&gt;@翻滚的蜗牛blog&lt;/a&gt;&lt;/p&gt;
</content>
    </entry>
    

</feed>
